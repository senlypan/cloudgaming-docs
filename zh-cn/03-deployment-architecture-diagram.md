# éƒ¨ç½²æ¶æ„è®¾è®¡

![è®¿é—®ç»Ÿè®¡](https://visitor-badge.glitch.me/badge?page_id=senlypan.cloudgaming.03-deployment-architecture-diagram&left_color=blue&right_color=red)

> ä½œè€…: å¤§å‚ç ”ç©¶å‘˜
>
> æ›´æ–°: 2022-08-18

## æ¦‚è¿°

### ğŸ“– å®šä¹‰

æè¿°åç«¯ç³»ç»Ÿå…·ä½“å¦‚ä½•éƒ¨ç½²ï¼Œå¯¹åº” 4+1 è§†å›¾çš„ç‰©ç†è§†å›¾ã€‚å‚è€ƒ [ã€Šé˜¿é‡Œäº‘ - è¿ç”¨RUP 4+1è§†å›¾æ–¹æ³•è¿›è¡Œè½¯ä»¶æ¶æ„è®¾è®¡ã€‹](https://developer.aliyun.com/article/458980)

![](../_media/image/02-system-architecture-diagram/4+1.jpg)

### ğŸŒ ä½¿ç”¨åœºæ™¯

1. æ€»ä½“æ¶æ„è®¾è®¡ï¼›
2. è¿ç»´è§„åˆ’å’Œä¼˜åŒ–ï¼›
3. é¢è¯•ã€æ™‹å‡ã€‚

### ğŸ¨ ç”»å›¾æŠ€å·§

1. ä½¿ç”¨ **å›¾æ ‡** ä»£æ›¿åŒºå—ã€‚

### ğŸ› ï¸ å·¥å…·æ¨è

1. [ProcessOn - åˆ¶å›¾å…±äº«å·¥å…·](https://www.processon.com/)
2. [Cloudcraft - éƒ¨ç½²æ¶æ„å›¾è®¾è®¡å·¥å…·](https://www.cloudcraft.co/)

### ğŸ‘‰ éƒ¨ç½²ç¤ºä¾‹

![](../_media/image/03-deployment-architecture-diagram/demo-001.jpg)


## äº‘æ¸¸æˆå¹³å°éƒ¨ç½²æ¶æ„

![](../_media/image/03-deployment-architecture-diagram/deployment-architecture-diagram-001.jpg)


è¯¦è§ [ProcessOn - äº‘æ¸¸æˆå¹³å°éƒ¨ç½²æ¶æ„](https://www.processon.com/view/link/62ff5d350e3e7437cac1c423)

!> å›¾ç‰‡é¢„è§ˆæ•ˆæœä¸ä½³ï¼Œå…·ä½“è¯·æ‰“å¼€ä»¥ä¸Šè¯¦ç»†é“¾æ¥


## ç½‘å…³ä¸­å¿ƒ

### æµé‡ç½‘å…³ä¸ä¸šåŠ¡ç½‘å…³åŸºæœ¬å…³ç³»

- é›†ç¾¤éš”ç¦»ï¼ˆæ··åˆæˆ–ç‹¬å ï¼‰

![](../_media/image/03-deployment-architecture-diagram/gateway-002.png)

ï¼ˆäº¿çº§æµé‡æ¶æ„ä¹‹ç½‘å…³è®¾è®¡æ€è·¯ã€å¸¸è§ç½‘å…³å¯¹æ¯” [via](https://www.cnblogs.com/Courage129/p/14446586.html)ï¼‰

- çº¿ç¨‹æ± éš”ç¦»

![](../_media/image/03-deployment-architecture-diagram/gateway-009.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰


### å¸¸è§ç½‘å…³å¯¹æ¯”

> ç›®å‰å¸¸è§çš„å¼€æºç½‘å…³å¤§è‡´ä¸ŠæŒ‰ç…§è¯­è¨€åˆ†ç±»æœ‰å¦‚ä¸‹å‡ ç±»:

| è¯­è¨€           | ç½‘å…³                               | 
| ---------------| --------------------------------- |
| Nginx + lua    | [OpenResty](http://openresty.org/)ã€[Kong](https://konghq.com/)ã€[Orange](http://orange.sumory.com/)ã€[Apache APISIX](https://apisix.apache.org/) ç­‰ |
| Java           | [Zuul1/Zuul2](https://github.com/Netflix/zuul)ã€[Spring Cloud Gateway](https://spring.io/projects/spring-cloud-gateway/)ã€[Apache ShenYu](https://shenyu.apache.org/)ã€[Kaazing KWG](https://kaazing.com)ã€[gravitee](https://www.gravitee.io/) ç­‰    |
| Go             | Janusã€fagongziã€Grpc-gateway ç­‰ |
| C++            | Envoy ç­‰                         |
| .net           | Ocelot ç­‰                        |
| NodeJS         | Express Gatewayã€Micro Gateway ç­‰|

> æŒ‰ç…§ä½¿ç”¨æ•°é‡ã€æˆç†Ÿåº¦ç­‰æ¥åˆ’åˆ†ï¼Œä¸»æµçš„æœ‰ 4 ä¸ªï¼š

- **OpenResty** 
    - Nginx + Lua
- **Kong/Orange** 
    - Nginx + Lua + OpenResty
- **Zuul/Zuul2** 
    - Javaï¼ˆServlet/Netty Serverï¼‰
- **Spring Cloud Gateway**
    - Javaï¼ˆWebFluxï¼‰

> äº’è”ç½‘ä¼ä¸šå¸¸è§çš„æ–¹æ¡ˆæœ‰åŸºäº Openresty çš„ Kongã€Orangeï¼ŒåŸºäº Java çš„ Zuul ç³»åˆ—ã€SpringCloudGateWay ï¼Œä»¥åŠåŸºäº Go çš„ Tyk

| ç»´åº¦         | OpenResty         | Kong                               | Orange                    |  Zuul 1         | Zuul 2         | SpringCloudGateway                 | 
| ---------    | ----------------- | -----------------------------------| ------------------------- | ----------------| ---------------| ---------------------------------- | 
| **æ•ˆç‡**     |  é«˜                | é«˜                                 | é«˜                        |  ä½             | ä¸€èˆ¬            | ä¸€èˆ¬ï¼ŒRPS æ˜¯ Zuul2 çš„ 1.6 å€   | 
| **å¼€å‘è¯­è¨€** |  Lua               | Lua                                | Lua                       |  Java           | Java           | Java                               | 
| **æŠ€æœ¯æ ˆ**   |  Nginx + Lua       | Nginx + Lua + OpenResty            | Nginx + Lua + OpenResty   |  Springboot     | Springboot     | Springboot                         | 
| **å­˜å‚¨**     |  Redisã€Memcached  | Cassandraã€PostgreSQL              | MySQL                     |  MySQL ç­‰       |  MySQL ç­‰       | MySQL ç­‰                          | 
| **æœåŠ¡æ³¨å†Œ** |  Consulã€ETCD      | Consulã€ETCD                       | Consulã€ETCD              |  Nacosã€Consul   | Nacosã€Consul  | Nacosã€Consul                      | 
| **é…ç½®ä¸­å¿ƒ** |  Consulã€ETCD      | Consulã€ETCD                       | Consulã€ETCD              |  Nacosã€Consul   | Nacosã€Consul  | Nacosã€Consul                      | 
| **ç®¡ç†ç•Œé¢** |  å¼€æº              |  ç¬¬ä¸‰æ–¹å¼€æº                         | å¼€æº                      |  å†…ç½®            | å†…ç½®           |  æ—                                 | 
| **ç¤¾åŒº**     |  æˆç†Ÿ              | ç›¸å¯¹æˆç†Ÿï¼Œç”¨æˆ·é—®é¢˜æ±‡æ€»ï¼Œç¤¾åŒºï¼Œæ’ä»¶å¼€æº| å°‘ï¼Œä¸ªäººå¼€å‘è€…             |  æˆç†Ÿ            | å¼€æºä¸ä¹…ï¼Œèµ„æ–™å°‘ | ç¤¾åŒºæˆç†Ÿï¼Œèµ„æºè¾ƒå°‘                  | 
| **ä»£ç **     |  å¼€æº              | å¼€æºï¼Œæ›´æ–°é¢‘ç¹                      | å¼€æº                      |  å¼€æº            | å¼€æº            |  å¼€æº                              | 
| **å­¦ä¹ æˆæœ¬** |  ç®€æ˜“ï¼Œéœ€è¿›è¡Œluaå¼€å‘| ç®€æ˜“ï¼Œç®€æ˜“ï¼Œéœ€è¿›è¡Œluaå¼€å‘            | è¾ƒé«˜                      |  ä¸€èˆ¬            | å‚è€ƒèµ„æ–™è¾ƒå°‘     | ç®€å•æ˜“ç”¨                           | 
| **ç»´æŠ¤æˆæœ¬** |  æ™®é€šï¼Œéœ€ç»´æŠ¤luaè„šæœ¬| è¾ƒé«˜ï¼Œéœ€è¦ç»´æŠ¤luaè„šæœ¬                | è¾ƒé«˜                      |  ä¸€èˆ¬            | ä¸€èˆ¬            | springç³»åˆ—å¯æ‰©å±•å¼ºï¼Œæ˜“é…ç½® å¯ç»´æŠ¤æ€§å¥½| 
| **æ‰©å±•**     |  è‡ªå»º              | æ”¯æŒé›†ç¾¤                           | æ”¯æŒé›†ç¾¤                   |  æ”¯æŒ            | æ”¯æŒ            |  æ”¯æŒ                              |  
| **å¤šèŠ‚ç‚¹**   |  è‡ªå»º              | æ”¯æŒ                               | éœ€è¦å¼€å‘                   |  æ”¯æŒ            | æ”¯æŒ            |  æ”¯æŒ                              | 
| **åŠŸèƒ½**     |  è‡ªå»º              | ä¸°å¯Œï¼Œéƒ¨åˆ†å¼€æº + å•†ä¸šï¼ˆæ”¶è´¹ï¼‰        | ä¸°å¯Œ                      |  ä¸°å¯Œ            | ä¸°å¯Œ            |  å¼‚æ­¥ï¼Œé…ç½®çµæ´»                      | 
| **é™æµ**     |  éœ€è¦luaå¼€å‘       | æ”¯æŒ                               |                           |  æ”¯æŒ            | æ”¯æŒ            |  æ”¯æŒ                               |
| **é‰´æƒ**     |  éœ€è¦luaå¼€å‘       | æ”¯æŒæ™®é€šé‰´æƒï¼ŒKey Authé‰´æƒï¼ŒHMACï¼Œauth2.0 |                      |  filterä¸­å®ç°    | filterä¸­å®ç°    |  æ”¯æŒæ™®é€šé‰´æƒã€auth2.0               | 
| **ç›‘æ§**     |  éœ€è¦luaå¼€å‘       | å†…ç½®                               |                           |  filterä¸­å®ç°    | filterä¸­å®ç°    |  Gateway Metrics Filter             |
| **WEbå®¹å™¨**   |                   |                                   |                           |  Servlet        |  Netty Server   |  WebFlux                           | 
| **çº¿ç¨‹æ¨¡å‹**  |                   |                                   |                           |  é˜»å¡            |  éé˜»å¡         |  éé˜»å¡                             | 
| **é€‚ç”¨åœºæ™¯**  |  å¤§å‹æµé‡ç½‘å…³      | å¤§å‹æµé‡ç½‘å…³                        | å¤§å‹æµé‡ç½‘å…³                |  ä¸­å°å‹ä¸šåŠ¡ç½‘å…³  | å¤§å‹ä¸šåŠ¡ç½‘å…³    | å¤§å‹ä¸šåŠ¡ç½‘å…³                        | 

### ç½‘å…³é£é™©è¯„ä¼°

![](../_media/image/03-deployment-architecture-diagram/gateway-point.jpg)

### ç½‘å…³è®¾è®¡é‡ç‚¹

- **é«˜æ€§èƒ½**
    - åœ¨æŠ€æœ¯è®¾è®¡ä¸Šï¼Œç½‘å…³ä¸åº”è¯¥ä¹Ÿä¸èƒ½æˆä¸ºæ€§èƒ½çš„ç“¶é¢ˆã€‚å¯¹äºé«˜æ€§èƒ½ï¼Œæœ€å¥½ä½¿ç”¨é«˜æ€§èƒ½çš„ç¼–ç¨‹è¯­è¨€æ¥å®ç°ï¼Œå¦‚ Cã€C++ã€Go å’Œ Javaã€‚ç½‘å…³å¯¹åç«¯çš„è¯·æ±‚ï¼Œä»¥åŠå¯¹å‰ç«¯çš„è¯·æ±‚çš„æœåŠ¡ä¸€å®šè¦ä½¿ç”¨å¼‚æ­¥éé˜»å¡çš„ I/O æ¥ç¡®ä¿åç«¯å»¶è¿Ÿä¸ä¼šå¯¼è‡´åº”ç”¨ç¨‹åºä¸­å‡ºç°æ€§èƒ½é—®é¢˜ã€‚C å’Œ C++ å¯ä»¥å‚çœ‹ Linux ä¸‹çš„ epoll å’Œ Windows çš„ I/O Completion Port çš„å¼‚æ­¥ IO æ¨¡å‹ï¼ŒJava ä¸‹å¦‚ Nettyã€Spring Reactor çš„ NIO æ¡†æ¶ã€‚
- **é«˜å¯ç”¨**
    - å› ä¸ºæ‰€æœ‰çš„æµé‡æˆ–è°ƒç”¨ç»è¿‡ç½‘å…³ï¼Œæ‰€ä»¥ç½‘å…³å¿…é¡»æˆä¸ºä¸€ä¸ªé«˜å¯ç”¨çš„æŠ€æœ¯ç»„ä»¶ï¼Œå®ƒçš„ç¨³å®šç›´æ¥å…³ç³»åˆ°äº†æ‰€æœ‰æœåŠ¡çš„ç¨³å®šã€‚ç½‘å…³å¦‚æœæ²¡æœ‰è®¾è®¡ï¼Œå°±ä¼šæˆå˜ä¸€ä¸ªå•ç‚¹æ•…éšœã€‚å› æ­¤ï¼Œä¸€ä¸ªå¥½çš„ç½‘å…³è‡³å°‘è¦åšåˆ°ä»¥ä¸‹å‡ ç‚¹ã€‚
    - **é›†ç¾¤åŒ–**ã€‚ç½‘å…³è¦æˆä¸ºä¸€ä¸ªé›†ç¾¤ï¼Œå…¶æœ€å¥½å¯ä»¥è‡ªå·±ç»„æˆä¸€ä¸ªé›†ç¾¤ï¼Œå¹¶å¯ä»¥è‡ªå·±åŒæ­¥é›†ç¾¤æ•°æ®ï¼Œè€Œä¸éœ€è¦ä¾èµ–äºä¸€ä¸ªç¬¬ä¸‰æ–¹ç³»ç»Ÿæ¥åŒæ­¥æ•°æ®ã€‚
    - **æœåŠ¡åŒ–**ã€‚ç½‘å…³è¿˜éœ€è¦åšåˆ°åœ¨ä¸é—´æ–­çš„æƒ…å†µä¸‹ä¿®æ”¹é…ç½®ï¼Œä¸€ç§æ˜¯åƒ Nginx reload é…ç½®é‚£æ ·ï¼Œå¯ä»¥åšåˆ°ä¸åœæœåŠ¡ï¼Œå¦ä¸€ç§æ˜¯æœ€å¥½åšåˆ°æœåŠ¡åŒ–ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¾—è¦æœ‰è‡ªå·±çš„ Admin API æ¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹è‡ªå·±çš„é…ç½®ã€‚
    - **æŒç»­åŒ–**ã€‚æ¯”å¦‚é‡å¯ï¼Œå°±æ˜¯åƒ Nginx é‚£æ ·ä¼˜é›…åœ°é‡å¯ã€‚æœ‰ä¸€ä¸ªä¸»ç®¡è¯·æ±‚åˆ†å‘çš„ä¸»è¿›ç¨‹ã€‚å½“æˆ‘ä»¬éœ€è¦é‡å¯æ—¶ï¼Œæ–°çš„è¯·æ±‚è¢«åˆ†é…åˆ°æ–°çš„è¿›ç¨‹ä¸­ï¼Œè€Œè€çš„è¿›ç¨‹å¤„ç†å®Œæ­£åœ¨å¤„ç†çš„è¯·æ±‚åå°±é€€å‡ºã€‚
- **é«˜æ‰©å±•**
    - å› ä¸ºç½‘å…³éœ€è¦æ‰¿æ¥æ‰€æœ‰çš„ä¸šåŠ¡æµé‡å’Œè¯·æ±‚ï¼Œæ‰€ä»¥ä¸€å®šä¼šæœ‰æˆ–å¤šæˆ–å°‘çš„ä¸šåŠ¡é€»è¾‘ã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä¸šåŠ¡é€»è¾‘æ˜¯å¤šå˜å’Œä¸ç¡®å®šçš„ã€‚æ¯”å¦‚ï¼Œéœ€è¦åœ¨ç½‘å…³ä¸ŠåŠ å…¥ä¸€äº›å’Œä¸šåŠ¡ç›¸å…³çš„ä¸œè¥¿ã€‚å› æ­¤ï¼Œä¸€ä¸ªå¥½çš„ Gateway è¿˜éœ€è¦æ˜¯å¯ä»¥æ‰©å±•çš„ï¼Œå¹¶èƒ½è¿›è¡ŒäºŒæ¬¡å¼€å‘çš„ã€‚å½“ç„¶ï¼Œåƒ Nginx é‚£æ ·é€šè¿‡ Module è¿›è¡ŒäºŒæ¬¡å¼€å‘çš„å›ºç„¶å¯ä»¥ã€‚å¦å¤–ï¼Œåœ¨è¿ç»´æ–¹é¢ï¼Œç½‘å…³åº”è¯¥æœ‰ä»¥ä¸‹å‡ ä¸ªè®¾è®¡åŸåˆ™ã€‚
    - **ä¸šåŠ¡æ¾è€¦åˆï¼Œåè®®ç´§è€¦åˆ**ã€‚åœ¨ä¸šåŠ¡è®¾è®¡ä¸Šï¼Œç½‘å…³ä¸åº”ä¸åé¢çš„æœåŠ¡ä¹‹é—´å½¢æˆæœåŠ¡è€¦åˆï¼Œä¹Ÿä¸åº”è¯¥æœ‰ä¸šåŠ¡é€»è¾‘ã€‚ç½‘å…³åº”è¯¥æ˜¯åœ¨ç½‘ç»œåº”ç”¨å±‚ä¸Šçš„ç»„ä»¶ï¼Œä¸åº”è¯¥å¤„ç†é€šè®¯åè®®ä½“ï¼Œåªåº”è¯¥è§£æå’Œå¤„ç†é€šè®¯åè®®å¤´ã€‚å¦å¤–ï¼Œé™¤äº†æœåŠ¡å‘ç°å¤–ï¼Œç½‘å…³ä¸åº”è¯¥æœ‰ç¬¬ä¸‰æ–¹æœåŠ¡çš„ä¾èµ–ã€‚
    - **åº”ç”¨ç›‘è§†ï¼Œæä¾›åˆ†ææ•°æ®**ã€‚ç½‘å…³ä¸Šéœ€è¦è€ƒè™‘åº”ç”¨æ€§èƒ½çš„ç›‘æ§ï¼Œé™¤äº†æœ‰ç›¸åº”åç«¯æœåŠ¡çš„é«˜å¯ç”¨çš„ç»Ÿè®¡ä¹‹å¤–ï¼Œè¿˜éœ€è¦ä½¿ç”¨ Tracing ID å®æ–½åˆ†å¸ƒå¼é“¾è·¯è·Ÿè¸ªï¼Œå¹¶ç»Ÿè®¡å¥½ä¸€å®šæ—¶é—´å†…æ¯ä¸ª API çš„ååé‡ã€å“åº”æ—¶é—´å’Œè¿”å›ç ï¼Œä»¥ä¾¿å¯åŠ¨å¼¹åŠ›è®¾è®¡ä¸­çš„ç›¸åº”ç­–ç•¥ã€‚
    - **ç”¨å¼¹åŠ›è®¾è®¡ä¿æŠ¤åç«¯æœåŠ¡**ã€‚ç½‘å…³ä¸Šä¸€å®šè¦å®ç°ç†”æ–­ã€é™æµã€é‡è¯•å’Œè¶…æ—¶ç­‰å¼¹åŠ›è®¾è®¡ã€‚å¦‚æœä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡è°ƒç”¨èŠ±è´¹çš„æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆå¯æ¥å—è¶…æ—¶å¹¶è¿”å›ä¸€éƒ¨åˆ†æ•°æ®ï¼Œæˆ–æ˜¯è¿”å›ä¸€ä¸ªç½‘å…³é‡Œçš„ç¼“å­˜çš„ä¸Šä¸€æ¬¡æˆåŠŸè¯·æ±‚çš„æ•°æ®ã€‚ä½ å¯ä»¥è€ƒè™‘ä¸€ä¸‹è¿™æ ·çš„è®¾è®¡ã€‚
    - **DevOps**ã€‚å› ä¸ºç½‘å…³è¿™ä¸ªç»„ä»¶å¤ªå…³é”®äº†ï¼Œæ‰€ä»¥éœ€è¦ DevOps è¿™æ ·çš„ä¸œè¥¿ï¼Œå°†å…¶å‘ç”Ÿæ•…éšœçš„æ¦‚ç‡é™åˆ°æœ€ä½ã€‚è¿™ä¸ªè½¯ä»¶éœ€è¦ç»è¿‡ç²¾è‰¯çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬åŠŸèƒ½å’Œæ€§èƒ½çš„æµ‹è¯•ï¼Œè¿˜æœ‰æµ¸æ³¡æµ‹è¯•ã€‚è¿˜éœ€è¦æœ‰ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–è¿ç»´çš„ç®¡æ§å·¥å…·ã€‚

### ç½‘å…³è®¾è®¡æ³¨æ„äº‹é¡¹

1. ä¸è¦åœ¨ç½‘å…³ä¸­çš„ä»£ç é‡Œå†…ç½®èšåˆåç«¯æœåŠ¡çš„åŠŸèƒ½ï¼Œè€Œåº”è€ƒè™‘å°†èšåˆæœåŠ¡æ”¾åœ¨ç½‘å…³æ ¸å¿ƒä»£ç ä¹‹å¤–ã€‚å¯ä»¥ä½¿ç”¨ Plugin çš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨ç½‘å…³åé¢å½¢æˆä¸€ä¸ª Serverless æœåŠ¡ã€‚
2. ç½‘å…³åº”è¯¥é è¿‘åç«¯æœåŠ¡ï¼Œå¹¶å’Œåç«¯æœåŠ¡ä½¿ç”¨åŒä¸€ä¸ªå†…ç½‘ï¼Œè¿™æ ·å¯ä»¥ä¿è¯ç½‘å…³å’Œåç«¯æœåŠ¡è°ƒç”¨çš„ä½å»¶è¿Ÿï¼Œå¹¶å¯ä»¥å‡å°‘å¾ˆå¤šç½‘ç»œä¸Šçš„é—®é¢˜ã€‚è¿™é‡Œå¤šè¯´ä¸€å¥ï¼Œç½‘å…³å¤„ç†çš„é™æ€å†…å®¹åº”è¯¥é è¿‘ç”¨æˆ·ï¼ˆåº”è¯¥æ”¾åˆ° CDN ä¸Šï¼‰ï¼Œè€Œç½‘å…³å’Œæ­¤æ—¶çš„åŠ¨æ€æœåŠ¡åº”è¯¥é è¿‘åç«¯æœåŠ¡ã€‚
3. ç½‘å…³ä¹Ÿéœ€è¦åšå®¹é‡æ‰©å±•ï¼Œæ‰€ä»¥éœ€è¦æˆä¸ºä¸€ä¸ªé›†ç¾¤æ¥åˆ†æ‹…å‰ç«¯å¸¦æ¥çš„æµé‡ã€‚è¿™ä¸€ç‚¹ï¼Œè¦ä¹ˆé€šè¿‡ DNS è½®è¯¢çš„æ–¹å¼å®ç°ï¼Œè¦ä¹ˆé€šè¿‡ CDN æ¥åšæµé‡è°ƒåº¦ï¼Œæˆ–è€…é€šè¿‡æ›´ä¸ºåº•å±‚çš„æ€§èƒ½æ›´é«˜çš„è´Ÿè½½å‡è¡¡è®¾å¤‡ã€‚
4. å¯¹äºæœåŠ¡å‘ç°ï¼Œå¯ä»¥åšä¸€ä¸ªæ—¶é—´ä¸é•¿çš„ç¼“å­˜ï¼Œè¿™æ ·ä¸éœ€è¦æ¯æ¬¡è¯·æ±‚éƒ½å»æŸ¥ä¸€ä¸‹ç›¸å…³çš„æœåŠ¡æ‰€åœ¨çš„åœ°æ–¹ã€‚å½“ç„¶ï¼Œå¦‚æœä½ çš„ç³»ç»Ÿä¸å¤æ‚ï¼Œå¯ä»¥è€ƒè™‘æŠŠæœåŠ¡å‘ç°çš„åŠŸèƒ½ç›´æ¥é›†æˆè¿›ç½‘å…³ä¸­ã€‚
5. ä¸ºç½‘å…³è€ƒè™‘ bulkhead è®¾è®¡æ–¹å¼ã€‚ç”¨ä¸åŒçš„ç½‘å…³æœåŠ¡ä¸åŒçš„åç«¯æœåŠ¡ï¼Œæˆ–æ˜¯ç”¨ä¸åŒçš„ç½‘å…³æœåŠ¡å‰ç«¯ä¸åŒçš„å®¢æˆ·ã€‚

å¦å¤–ï¼Œå› ä¸ºç½‘å…³æ˜¯ä¸ºç”¨æˆ·è¯·æ±‚å’Œåç«¯æœåŠ¡çš„æ¡¥æ¥è£…ç½®ï¼Œæ‰€ä»¥éœ€è¦è€ƒè™‘ä¸€äº›å®‰å…¨æ–¹é¢çš„äº‹å®œã€‚å…·ä½“å¦‚ä¸‹ï¼š

1. **åŠ å¯†æ•°æ®**ã€‚å¯ä»¥æŠŠ SSL ç›¸å…³çš„è¯ä¹¦æ”¾åˆ°ç½‘å…³ä¸Šï¼Œç”±ç½‘å…³åšç»Ÿä¸€çš„ SSL ä¼ è¾“ç®¡ç†ã€‚
2. **æ ¡éªŒç”¨æˆ·çš„è¯·æ±‚**ã€‚ä¸€äº›åŸºæœ¬çš„ç”¨æˆ·éªŒè¯å¯ä»¥æ”¾åœ¨ç½‘å…³ä¸Šæ¥åšï¼Œæ¯”å¦‚ç”¨æˆ·æ˜¯å¦å·²ç™»å½•ï¼Œç”¨æˆ·è¯·æ±‚ä¸­çš„ token æ˜¯å¦åˆæ³•ç­‰ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æƒè¡¡ä¸€ä¸‹ï¼Œç½‘å…³æ˜¯å¦éœ€è¦æ ¡éªŒç”¨æˆ·çš„è¾“å…¥ã€‚å› ä¸ºè¿™æ ·ä¸€æ¥ï¼Œç½‘å…³å°±éœ€è¦ä»åªå…³å¿ƒåè®®å¤´ï¼Œåˆ°éœ€è¦å…³å¿ƒåè®®ä½“ã€‚è€Œåè®®ä½“ä¸­çš„ä¸œè¥¿ä¸€æ–¹é¢ä¸åƒåè®®å¤´æ˜¯æ ‡å‡†çš„ï¼Œå¦ä¸€æ–¹é¢è§£æåè®®ä½“è¿˜è¦è€—è´¹å¤§é‡çš„è¿è¡Œæ—¶é—´ï¼Œä»è€Œé™ä½ç½‘å…³çš„æ€§èƒ½ã€‚å¯¹æ­¤ï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œçœ‹å…·ä½“éœ€æ±‚ï¼Œä¸€æ–¹é¢å¦‚æœåè®®ä½“æ˜¯æ ‡å‡†çš„ï¼Œé‚£ä¹ˆå¯ä»¥å¹²ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹äºè§£æåè®®æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œéœ€è¦åšç›¸åº”çš„éš”ç¦»ã€‚
3. **æ£€æµ‹å¼‚å¸¸è®¿é—®**ã€‚ç½‘å…³éœ€è¦æ£€æµ‹ä¸€äº›å¼‚å¸¸è®¿é—®ï¼Œæ¯”å¦‚ï¼Œåœ¨ä¸€æ®µæ¯”è¾ƒçŸ­çš„æ—¶é—´å†…è¯·æ±‚æ¬¡æ•°è¶…è¿‡ä¸€å®šæ•°å€¼ï¼›è¿˜æ¯”å¦‚ï¼ŒåŒä¸€å®¢æˆ·ç«¯çš„ 4xx è¯·æ±‚å‡ºé”™ç‡å¤ªé«˜â€¦â€¦å¯¹äºè¿™æ ·çš„ä¸€äº›è¯·æ±‚è®¿é—®ï¼Œç½‘å…³ä¸€æ–¹é¢è¦æŠŠè¿™æ ·çš„è¯·æ±‚å±è”½æ‰ï¼Œå¦ä¸€æ–¹é¢éœ€è¦å‘å‡ºè­¦å‘Šï¼Œæœ‰å¯èƒ½ä¼šæ˜¯ä¸€äº›æ¯”è¾ƒé‡å¤§çš„å®‰å…¨é—®é¢˜ï¼Œå¦‚è¢«é»‘å®¢æ”»å‡»ã€‚


### é€‰å‹åˆæ­¥æ¨è®º

ğŸ‘‰ å¯¹äºç°æœ‰è§„æ¨¡å°çš„é¡¹ç›®ã€æ¥å…¥æˆæœ¬æœ‰é™åˆ¶çš„é¡¹ç›®ã€ä»¥ Java å¼€å‘è¯­è¨€ä¸ºä¸»å¯¼ **ä¸”** å¯¹ä¸Šçº¿æœ‰è¿«åˆ‡è¦æ±‚çš„å›¢é˜Ÿï¼Œæ¨èä¼˜å…ˆä½¿ç”¨ **Spring Cloud Gateway** æˆ– **Apache ShenYu**ï¼Œå°é²œå¯ä»¥ä½¿ç”¨ **Zuul2**ï¼Œæ®è¯´æ€§èƒ½å¾ˆæœ‰ä¼˜åŠ¿ï¼Œè‡³äº **Zuul1** ç”±äºæ•ˆç‡ç“¶é¢ˆï¼Œå·²ä¸å†æ¨èã€‚

ğŸ¤Œ å¯¹äºæœªæ¥æœ‰é¢„æœŸçš„é¡¹ç›®ã€æ¥å…¥æˆæœ¬æœ‰ç©ºé—´çš„é¡¹ç›®ã€æœ‰ Nginx å®è·µç»éªŒ **æˆ–** å­¦ä¹ èƒ½åŠ›å¼º **ä¸”** å…è®¸æˆé•¿çš„å›¢é˜Ÿï¼Œæ¨èä½¿ç”¨ **Kong** ï¼Œå¯¹æ•ˆç‡æœ‰æ›´é«˜è¦æ±‚å¯ä»¥è‡ªå»º **OpenResty**ï¼Œå½“ç„¶æƒ³å°é²œå›½äº§ç½‘å…³å¯ä»¥è¯•ç”¨ **Apache APISIX** ï¼ŒåŠŸèƒ½ä¹Ÿç›¸å½“å®Œå¤‡ã€‚

â˜ï¸ å¯¹äºæœ‰äº‘åŸç”Ÿè§„åˆ’çš„é¡¹ç›®ï¼Œå»ºè®®æ›´å¤šå‚è€ƒ [CNCF Cloud Native && API GateWay](https://landscape.cncf.io/card-mode?category=api-gateway) çš„è¶‹åŠ¿ã€‚ 

### äº‘åŸç”ŸåŸºé‡‘ä¼šç½‘å…³ç°çŠ¶

![](../_media/image/03-deployment-architecture-diagram/cncf-gateway.jpg)

ï¼ˆCNCF Cloud Native && API GateWay. [via](https://landscape.cncf.io/card-mode?category=api-gateway)ï¼‰

### éƒ¨ç½²æ¶æ„å‚è€ƒ

![](../_media/image/03-deployment-architecture-diagram/gateway-003.png)

ï¼ˆå¤©ç¿¼è´¦å·ç½‘å…³ç³»ç»Ÿ 3.0 [via](https://xie.infoq.cn/article/c6703d216c43c2b522b9b4ffa)ï¼‰

![](../_media/image/03-deployment-architecture-diagram/gateway-008.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

![](../_media/image/03-deployment-architecture-diagram/gateway-004.png)

ï¼ˆApache ShenYu 2.4.2 [via](https://shenyu.apache.org/zh/docs/2.4.2/index)ï¼‰

![](../_media/image/03-deployment-architecture-diagram/gateway-005.png)

ï¼ˆApache ShenYu 2.4.3 [via](https://shenyu.apache.org/zh/docs/index)ï¼‰

### ä¸šåŠ¡ç½‘å…³åŠŸèƒ½åŸºæœ¬è¦æ±‚

- **æ‹¦æˆªå±‚**
    - é‰´æƒ
    - åçˆ¬
    - é»‘ç™½åå•
    - XXS é˜²å¾¡
    - æ•°æ®åŠ å¯†
    - SSL åŠ å¯†
    - è¯ä¹¦ç®¡ç†
- **è°ƒåº¦å±‚**
    - æœåŠ¡æ³¨å†Œ
    - åŠ¨æ€è·¯ç”±
    - è´Ÿè½½å‡è¡¡
    - ç°åº¦å‘å¸ƒ
    - API ç¼–æ’
    - API èšåˆ
    - åˆ†ç»„éš”ç¦»
    - æµé‡å¤åˆ¶
- **é€šä¿¡å±‚**
    - æ—¥å¿—
    - ç›‘æ§
    - ç¼“å­˜
    - Mock æµ‹è¯•
    - åè®®é€‚é…
    - ç†”æ–­é™æµ
    - æœåŠ¡é™çº§
    - é‡è¯•
    - å¹‚ç­‰
    - å¼‚æ­¥
    - é…ç½®åŒæ­¥
- **æ‰©å±•å±‚**
    - SPI æ‰©å±•
    - ç»„ä»¶å¸‚åœº

![](../_media/image/03-deployment-architecture-diagram/gateway-001.png)

ï¼ˆQunaræŠ€æœ¯æ²™é¾™ - ä¸šåŠ¡ç½‘å…³çš„è½åœ°å®è·µ [via](https://www.infoq.cn/article/cAcwMUNMJMQpIxGJYkcS)ï¼‰

![](../_media/image/03-deployment-architecture-diagram/gateway-007.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### API å‘å¸ƒæµç¨‹

![](../_media/image/03-deployment-architecture-diagram/gateway-006.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### ç¨³å®šæ€§ä¿éšœ

![](../_media/image/03-deployment-architecture-diagram/gateway-010.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### ç°åº¦åœºæ™¯

![](../_media/image/03-deployment-architecture-diagram/gateway-011.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### æ•…éšœè‡ªæ„ˆ

![](../_media/image/03-deployment-architecture-diagram/gateway-012.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### é™æ€ç½‘ç«™æ‰˜ç®¡

![](../_media/image/03-deployment-architecture-diagram/gateway-013.png)

ï¼ˆç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç° [via](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)ï¼‰

### ç½‘å…³é€‰å‹å‚è€ƒ

- [InfoQ - å¤©ç¿¼è´¦å·ç½‘å…³ç³»ç»Ÿæ¶æ„æ¼”è¿›å†ç¨‹](https://xie.infoq.cn/article/c6703d216c43c2b522b9b4ffa)

- [InfoQ - ä¸šåŠ¡ç½‘å…³çš„è½åœ°å®è·µ](https://www.infoq.cn/article/cAcwMUNMJMQpIxGJYkcS)

- [QunaræŠ€æœ¯æ²™é¾™ - äº¿çº§æµé‡æ¶æ„ä¹‹ç½‘å…³è®¾è®¡æ€è·¯ã€å¸¸è§ç½‘å…³å¯¹æ¯”](https://www.cnblogs.com/Courage129/p/14446586.html)

- [ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ - ç™¾äº¿è§„æ¨¡APIç½‘å…³æœåŠ¡Shepherdçš„è®¾è®¡ä¸å®ç°](https://mp.weixin.qq.com/s/iITqdIiHi3XGKq6u6FRVdg)

## æ¶ˆæ¯æœåŠ¡

> å‡ ç§å¸¸ç”¨MQå¯¹æ¯”

| ç»´åº¦    | ActiveMQ                       | RabbitMQ                       | RocketMQ             | Kafka              | 
|-------|--------------------------------|--------------------------------|----------------------|-----------------| 
| å¤šè¯­è¨€æ”¯æŒ | æ”¯æŒï¼ŒJAVAä¼˜å…ˆ                      | è¯­è¨€æ— å…³                           | åªæ”¯æŒJava              | æ”¯æŒï¼ŒJavaä¼˜å…ˆ       |
| å•æœºååé‡ | ä¸‡çº§                             | ä¸‡çº§                             | 10ä¸‡çº§                 | 10ä¸‡çº§              | 
| æ—¶æ•ˆæ€§   | msçº§                            | å¾®ç§’çº§                            | msçº§                  | msçº§ä»¥å†…          | 
| æŒä¹…åŒ–   | å†…å­˜ã€æ–‡ä»¶ã€æ•°æ®åº“                      | å†…å­˜ã€æ–‡ä»¶ï¼Œæ”¯æŒæ•°æ®å †ç§¯ï¼Œä½†æ•°æ®å †ç§¯ä¼šå½±å“ç”Ÿäº§é€Ÿç‡      | ç£ç›˜æ–‡ä»¶        | ç£ç›˜æ–‡ä»¶ï¼Œåªè¦ç£ç›˜å®¹é‡è¶³å¤Ÿï¼Œå¯ä»¥åšåˆ°æ— é™æ¶ˆæ¯å †ç§¯ | 
| åŠŸèƒ½æ”¯æŒ  | MQé¢†åŸŸçš„åŠŸèƒ½æå…¶å®Œå¤‡                    | åŸºäºerlangå¼€å‘ï¼Œæ‰€ä»¥å¹¶å‘èƒ½åŠ›å¾ˆå¼ºï¼Œæ€§èƒ½æå…¶å¥½ï¼Œå»¶æ—¶å¾ˆä½ | MQåŠŸèƒ½è¾ƒä¸ºå®Œå–„ï¼Œè¿˜æ˜¯åˆ†å¸ƒå¼çš„ï¼Œæ‰©å±•æ€§å¥½ | åŠŸèƒ½è¾ƒä¸ºç®€å•ï¼Œä¸»è¦æ”¯æŒç®€å•çš„MQåŠŸèƒ½ï¼Œåœ¨å¤§æ•°æ®é¢†åŸŸçš„å®æ—¶è®¡ç®—ä»¥åŠæ—¥å¿—é‡‡é›†è¢«å¤§è§„æ¨¡ä½¿ç”¨ï¼Œæ˜¯äº‹å®ä¸Šçš„æ ‡å‡† | 
| å¯ç”¨æ€§   | é«˜ï¼ˆä¸»ä»ï¼‰                          | é«˜ï¼ˆä¸»ä»ï¼‰                          | éå¸¸é«˜ï¼ˆåˆ†å¸ƒå¼ï¼‰             | éå¸¸é«˜ï¼ˆåˆ†å¸ƒå¼ï¼‰        | 
| æ¶ˆæ¯ä¸¢å¤±  | ä½                              | ä½                              | éå¸¸é«˜ï¼ˆåˆ†å¸ƒå¼ï¼‰             | ä¸­              | 
| ç¤¾åŒºæ´»è·ƒåº¦ | é«˜                              | é«˜                              | ä¸­                    | é«˜              | 
| æˆç†Ÿåº¦   | æˆç†Ÿ                             | æˆç†Ÿ                             | æ¯”è¾ƒæˆç†Ÿ                 | æˆç†Ÿæ—¥å¿—é¢†åŸŸ         | 
| æ”¯æŒåè®®  | OpenWirteã€Stompã€restã€amopã€xmpp | AMQP                           | è‡ªå·±å®šä¹‰çš„ä¸€å¥—              |            | 
| äº‹åŠ¡    | æ”¯æŒ                             | ä¸æ”¯æŒ                            | æ”¯æŒ                   |                | 
| è´Ÿè½½å‡è¡¡  | æ”¯æŒ                             | æ”¯æŒ                             | æ”¯æŒ                   |                | 
| éƒ¨ç½²æ–¹å¼  | ç‹¬ç«‹ã€åµŒå…¥                          | ç‹¬ç«‹                             | ç‹¬ç«‹                   |                | 

> å¸¸ç”¨MQä¼˜ç¼ºç‚¹åŠåº”ç”¨åœºæ™¯

é“¾æ¥ï¼šhttp://assets.processon.com/chart_image/630a0f2d63768906ff68ca0e.png

![](../_media/image/03-deployment-architecture-diagram/mqçš„ä¼˜ç¼ºç‚¹å’Œåº”ç”¨åœºæ™¯.png)

#### mqåŸºæœ¬æ¶æ„
![](../_media/image/03-deployment-architecture-diagram/mq-base-architecture.jpg)

#### kafkaé›†ç¾¤æ¶æ„
![](../_media/image/03-deployment-architecture-diagram/kafka-architecture.png)

#### rocketmqé›†ç¾¤æ¶æ„
![](../_media/image/03-deployment-architecture-diagram/rocketmq-architecture.png)

#### activemqé›†ç¾¤æ¶æ„
##### 1.p2p
![](../_media/image/03-deployment-architecture-diagram/activemq-p2p.png)

##### 2.p/s
![](../_media/image/03-deployment-architecture-diagram/activemq-ps.png)

#### rabbitmqé›†ç¾¤æ¶æ„
![](../_media/image/03-deployment-architecture-diagram/rabbitmq-architect.jpeg)

## æ–‡ä»¶æœåŠ¡

`å¾…è¡¥å……`

## ä»»åŠ¡è°ƒåº¦

### ä½¿ç”¨åœºæ™¯

>1.åˆåŒåˆ°æœŸï¼Œå®šæ—¶ä»»åŠ¡å¤„ç†ï¼Œå¤„ç†ç›¸å…³çš„èµ„æºï¼Œå¤„ç†ç›¸å…³çš„é€šçŸ¥<br>
>2.æ¯æ—¥ï¼Œæ¯æœˆç”Ÿæˆæ—¥è´¦å•å’Œæœˆè´¦å•<br>
>3.å®šæ—¶æŸ¥è¯¢ç›¸å…³ä¼ä¸šé£é™©ï¼Œåˆ†æç›¸å…³æƒ…å†µ<br>
>4.å®šæ—¶åˆ†æèµ„æºæƒ…å†µ<br>
>5.è®¢å•æ”¯ä»˜è¶…æ—¶<br>
>6.å®šæ—¶åŒæ­¥æ•°æ®

### é€‰å‹


![](../_media/image/03-tech-architecture-diagram/job-compare.jpg)


### xxl-job æ¶æ„

![](../_media/image/03-tech-architecture-diagram/xxl-job.png)
#### éƒ¨ç½²
![](../_media/image/03-tech-architecture-diagram/xxl-job-deployment-001.jpg)
#### ä»»åŠ¡è°ƒåº¦
![](../_media/image/03-tech-architecture-diagram/xxl-job-dispatch.jpg)
#### æ‰§è¡Œå™¨æ³¨å†Œ
![](../_media/image/03-tech-architecture-diagram/xxl-job-executor.jpg)
#### æ•…éšœè½¬ç§»
![](../_media/image/03-tech-architecture-diagram/xxl-job-failover.jpg)
#### å¤±è´¥é‡è¯•
![](../_media/image/03-tech-architecture-diagram/xxl-job-executor-fail.jpg)
#### è¶…æ—¶ å¤±è´¥é‡è¯•
![](../_media/image/03-tech-architecture-diagram/xxl-job-executor-fail2.jpg)
## åˆ†å¸ƒå¼äº‹åŠ¡

`å¾…è¡¥å……`

## é…ç½®ä¸­å¿ƒä¸æ³¨å†Œä¸­å¿ƒ

`å¾…è¡¥å……`

## ç¼“å­˜æœåŠ¡

> å‡ ç§å¸¸ç”¨ç¼“å­˜å¯¹æ¯”



| ç»´åº¦ | memcache | redis | ehcache | guava | hashmap |
| ---- | -------- | ----- | ------- | ----- | ------- |
|   **æ˜¯å¦æ˜¯åˆ†å¸ƒå¼ç¼“å­˜**   |    æ˜¯      |   æ˜¯    |   æ˜¯ï¼Œä½†ä¸€è‡´æ€§ä¸é«˜   |   å¦    |       å¦  |
| **æ˜¯å¦æ”¯æŒæŒä¹…åŒ–** | å¦ | æ˜¯ | æ˜¯ | å¦ | å¦ |
| **é«˜å¯ç”¨** | æ˜¯ï¼Œä¾èµ–æ’ä»¶ | æ˜¯ | æ˜¯ | å¦ | å¦ |
| **è¿‡æœŸç­–ç•¥** | æ˜¯ | æ˜¯ | æ˜¯ | æ˜¯ | å¦ |
| **å¯å­˜å‚¨æ•°æ®å¤§å°** | æœåŠ¡å™¨å†…å­˜ | æœåŠ¡å™¨å†…å­˜ | æœåŠ¡å™¨å†…å­˜+ç£ç›˜ | jvmå†…å­˜| jvmå†…å­˜|
| **ç‰¹æ€§** | åˆ†å¸ƒå¼æ¨¡å¼ä¸‹æœ€å¿«ç¼“å­˜ï¼Œå¯å­˜å‚¨å›¾ç‰‡è§†é¢‘ | æ”¯æŒå¤šç§ç±»å‹æ•°æ®ï¼Œç”¨æ³•çµæ´»ï¼Œå¯ä»¥ä½œä¸ºå†…å­˜æ•°æ®åº“ä½¿ç”¨ | è½»é‡ï¼Œå¿«ï¼Œæ— é™å­˜å‚¨ | ç®€å•è½»é‡,æ›´æ–°é”å®šï¼Œé›†æˆdbå›å¡«| javaå†…ç½®|



> ç¼“å­˜ä¼˜ç‚¹
* memcache: å¤šçº¿ç¨‹ï¼Œé€Ÿåº¦å¿«ï¼Œæ— å†…å­˜ç¢ç‰‡å†…å­˜ä½¿ç”¨ç‡é«˜
* Redis: æ”¯æŒæ•°æ®ç»“æ„å¤šï¼Œçµæ´»å¯é ï¼ŒåŠŸèƒ½å¤šï¼Œå¯åšnosqlæ•°æ®åº“ï¼Œmqç”šè‡³æ•°æ®åˆ†æï¼Œæˆç†Ÿé«˜å¯ç”¨æ–¹æ¡ˆ
* ehcache: æ”¯æŒåˆ†å¸ƒå¼çš„æœ¬åœ°ç¼“å­˜ ç®€å•è½»ä¾¿
* guava: æœ¬åœ°ç¼“å­˜ç®€å•é«˜æ•ˆ
* hashmap: æœ¬åœ°ç¼“å­˜ javaå†…ç½®

> é€‰å‹æ¨è

* åˆ†å¸ƒå¼ç¼“å­˜é¦–é€‰redis, è¿½æ±‚æè‡´æ€§èƒ½ä¸”è¯»å¤šå†™å°‘ä¸”å¯é æ€§è¦æ±‚ä¸é«˜å¯è€ƒè™‘å°è¯•memcache
* æœ¬åœ°ç¼“å­˜é¦–é€‰guava, å¦‚éœ€è¦åˆ†å¸ƒå¼ç¼“å­˜ä¸”ä¸æƒ³ç”¨rediså¯å°è¯•ehcacheï¼Œè¿½æ±‚é™ä½å­¦ä¹ æˆæœ¬åŠä¾èµ–ä¸”å­˜å‚¨å‡ ä¹ä¸å˜æ•°æ®å¯é€‰æ‹©hashmap



> Redis éƒ¨ç½²æ¶æ„ç¤ºæ„å›¾

![redis-deployment](../_media/image/03-deployment-architecture-diagram/redis-deployment.png)

## å…³ç³»æ•°æ®åº“æœåŠ¡

> å‡ ç§å¸¸ç”¨DBMSå¯¹æ¯”


| ç»´åº¦ | mysql | pgsql | oracle |
| ---- | -------- | ----- | ------- |
|   **æ˜¯å¦å¼€æº**   |    æ˜¯      |   æ˜¯    |   å¦|
| **æ”¯æŒç³»ç»Ÿ** | all | all | all | 
| **äº‹åŠ¡æ”¯æŒ** | æ”¯æŒ | æ”¯æŒ | æ”¯æŒ |
| **æŠ€æœ¯æ”¯æŒ** | ç¤¾åŒº | ç¤¾åŒº | å®¢æœ |
| **å­˜å‚¨ç»“æ„** | ç´¢å¼•ç»„ç»‡è¡¨ | å †è¡¨ | éƒ½æ”¯æŒ |
| **sqlæ”¯æŒ** | å®½æ¾sql | ä¸¥æ ¼sql | ä¸¥æ ¼sql|
| **å¤æ‚sqlæ”¯æŒ** | ä½ | é«˜ | é«˜|
| **å¹¶å‘æ¨¡å¼** | å•è¿›ç¨‹å¤šçº¿ç¨‹ | å¤šè¿›ç¨‹ | å¤šè¿›ç¨‹|
| **ä¸»ä»å¤åˆ¶** | biglogé€»è¾‘å¤åˆ¶ | ç‰©ç†å¤åˆ¶ | ç‰©ç†å¤åˆ¶|

> ä¼˜åŠ¿åˆ†æ
* mysqlä¼˜åŠ¿ï¼šå¤šå­˜å‚¨å¼•æ“ï¼Œç›¸å¯¹çµæ´»ï¼Œå¼€æºç®€å•ï¼Œå­¦ä¹ æˆæœ¬ä½ï¼Œå¤šçº¿ç¨‹æ¨¡å¼å•æœºæ€§èƒ½é«˜ï¼Œå¤©ç„¶æ”¯æŒé«˜é“¾æ¥
* pgsqlä¼˜åŠ¿ï¼šå¼€æºï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œæ”¯æŒå¤§é‡å¤æ‚å‡½æ•°ï¼Œæ”¯æŒå¤šç´¢å¼•ï¼Œæ”¯æŒå‡½æ•°å†…ç´¢å¼•ï¼Œå¯¹oracleå…¼å®¹è¾ƒå¥½
* oracleä¼˜åŠ¿ï¼šå¥½çš„ä¸œè¥¿é™¤äº†è´µå“ªéƒ½å¥½

> é€‰å‹æ¨è

* ä¸­å°å‹é¡¹ç›®å¯é€‰mysql,è®¡ç®—é‡è¾ƒå¤§æˆ–æ•°æ®ä»“åº“é¡¹ç›®å¯é€‰ pgæˆ–oracle
* é¡¹ç›®æ•°æ®åºå¤§ï¼Œè®¡ç®—é‡åºå¤§ï¼Œå¯é æ€§å’Œç¨³å®šæ€§è¦æ±‚é«˜æŠ€æœ¯å¼ºå¤§ï¼Œé¢„ç®—è¶³å¤Ÿä¸”ä¸æƒ§åˆ¶è£é¦–é€‰oracle





> å¸¸ç”¨åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶å¯¹æ¯”


| ç»´åº¦ | mycat | shardingjdbc | tddl |
| ---- | -------- | ----- | ------- |
|   **æ˜¯å¦å¼€æº**   |    æ˜¯      |   æ˜¯    |   å¦|
| **æ˜¯å¦ä¸­å¿ƒåŒ–** | æ˜¯ | å¦ | å¦ | 
| **ormæ”¯æŒ** | ä»»æ„ | ä»»æ„ | ä»»æ„ |
| **æ•°æ®åº“æ”¯æŒ** | jdbc | jdbc | jdbc |
| **è¯­è¨€æ”¯æŒ** | ä»»æ„ | java | java |
| **å¤–éƒ¨ä¾èµ–** | æ—  | æ—  | diamondï¼ˆé˜¿é‡Œå†…éƒ¨ç»„ä»¶ï¼‰|
| **å¤æ‚sqlæ”¯æŒ** | ä½ | é«˜ | é«˜|
| **ä»£ç ä¾µå…¥æ€§** | ä½ | æ—  | â€”â€”|
| **è·¨åº“join** | æ”¯æŒ | æ”¯æŒ | â€”â€”|
| **åˆ†å¸ƒå¼äº‹åŠ¡** | æ”¯æŒ | æ”¯æŒ | â€”â€”|
| **ç¤¾åŒºæ´»è·ƒåº¦** | é«˜ | é«˜ | â€”â€”|
| **æˆç†Ÿåº¦** | é«˜ | ä¸­ | â€”â€”|
| **å¯æ‰©å±•æ€§** | é«˜ | ä½ | â€”â€”|
| **å¼¹æ€§ä¼¸ç¼©** | æ”¯æŒ | ä¸æ”¯æŒ | â€”â€”|



> ä¼˜åŠ¿åˆ†æ

* mycat: å¼€æºï¼ŒåŠŸèƒ½å¼ºå¤§ï¼Œå¯¹åº”ç”¨é€æ˜ï¼Œæ•°æ®æ²»ç†æ–¹ä¾¿
* Sharding-jdbc: å¼€æºè½»é‡ï¼Œä»£ç æ— ä¾µå…¥ï¼Œè¿ç»´ç®€å•
* Tddl:  é˜¿é‡Œå‡ºå“ ç¨³å®šå¼ºå¤§



> é€‰å‹å»ºè®®

* å¼‚æ„é¡¹ç›®ã€å¤§å‹é¡¹ç›®ã€æ•°æ®å¢é•¿å¿«é€Ÿæœ‰é«˜å¯ç”¨ã€å¼¹æ€§ä¼¸ç¼©éœ€æ±‚å¯é€‰mycat
* ä¸­å°å‹javaé¡¹ç›®ï¼Œæ•°æ®å¢é•¿ç¼“æ…¢å¯é€‰sharding-jdbc
* é˜¿é‡Œå†…éƒ¨é¡¹ç›® å¯é€‰tddl

> åˆ†åº“åˆ†è¡¨ä¸­é—´ä»¶åŠŸèƒ½åŸºæœ¬è¦æ±‚

* åˆ†ç‰‡
* è·¯ç”±
* å”¯ä¸€ä¸»é”®
* ä¸»ä»é…ç½®
* è·¨åº“join
* åˆ†å¸ƒå¼äº‹åŠ¡
* ç»“æœèšåˆ

> Mycat éƒ¨ç½²æ¶æ„ç¤ºæ„å›¾

![mycat-deployment](../_media/image/03-deployment-architecture-diagram/mycat-deployment.png)

## è‡ªåŠ¨åŒ–æ„å»ºæµ‹è¯•å‘å¸ƒæœåŠ¡

![](../_media/image/03-tech-architecture-diagram/auto-build-test-publish.png)
### éƒ¨ç½²
![](../_media/image/03-tech-architecture-diagram/auto-build-test-publish-002.jpg)

## å®¹å™¨åŒ–éƒ¨ç½²

`å¾…è¡¥å……`

## æ—¥å¿—ä¸­å¿ƒ

`å¾…è¡¥å……`

## åˆ†å¸ƒå¼äº‹åŠ¡é›†ç¾¤

`å¾…è¡¥å……`

## å¤§æ•°æ®ä¸­å¿ƒï¼ˆæ•°æ®é‡‡é›†åˆ†æï¼‰

### æ•°æ®åˆ†ææŠ€æœ¯æ¶æ„

![data_analyze_framework](../_media/image/03-outline-design/data_analyze_framework.png)

### æ•°æ®åˆ†æå¼€å‘æµç¨‹

![data_analyze_development_flow](../_media/image/03-outline-design/data_analyze_development_flow.png)

## æ€§èƒ½ç›‘æ§ä¸­å¿ƒï¼ˆå…¨é“¾è·¯è¿½è¸ªï¼‰

`å¾…è¡¥å……` 

## å‚è€ƒ

- [æå®¢ä¸“æ  - å¦‚ä½•ç”»å¥½æ¶æ„å›¾](https://u.geekbang.org/lesson/381) ğŸ‘ğŸ‘ğŸ‘

- [å¾®ä¿¡ - å¦‚ä½•ç”»å¥½ä¸€å¼ æ¶æ„å›¾ï¼Ÿ](https://mp.weixin.qq.com/s/2HjvNnfP7bLNQF5xh8PxIQ)